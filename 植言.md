# 数据表

## 植物百科数据表

**表名：plants_encyclopedia**

**说明：植物百科**

**数据列：**

| 序号 | 字段名                    | 类型     | 长度 | 约束   | 说明                                   |
| ---- | :------------------------ | -------- | :--- | :----- | -------------------------------------- |
| 1    | plant_name                | VARCHAR  | 20   | 不为空 | 植物名                                 |
| 2    | plant_id                  | CHAR     | 16   | 主键   | 植物id（门纲目科属种）                 |
| 3    | plant_scientific_name     | VARCHAR  | 50   | 不为空 | 植物学名                               |
| 4    | plant_alias_name          | VARCHAR  | 50   | 无     | 植物别名                               |
| 5    | plant_families_and_genera | CHAR     | 16   | 不为空 | 植物科属（分表）                       |
| 6    | temperature_demand        | CHAR     | 4    | 不为空 | 温度需求（前两位为最低，后两位为最高） |
| 7    | water_demand              | CHAR     | 4    | 不为空 | 湿度需求（前两位为最低，后两位为最高） |
| 8    | fertilization_demand      | CHAR     | 32   | 不为空 | 施肥需求                               |
| 9    | plant_introduction        | TEXT     |      | 不为空 | 植物简介                               |
| 10   | plant_growth_environment  | TEXT     |      | 不为空 | 生长环境                               |
| 11   | reproductive_methods      | TEXT     |      | 不为空 | 繁殖方法                               |
| 12   | plant_image_url           | VARCHAR  | 100  | 不为空 | 图片URL                                |
| 13   | plant_growth_cycle        | SMALLINT |      | 不为空 | 生长周期                               |
| 14   | plant_type                | CHAR     | 10   | 不为空 | 类型                                   |



## 个人信息数据表

**表名：user_information**

**说明：个人信息**

**数据列：**

| 序号 | 字段名        | 类型                                                         | 长度 | 约束   | 默认值 | 说明     |
| ---- | ------------- | ------------------------------------------------------------ | ---- | ------ | ------ | -------- |
| 1    | user_name     | CHAR                                                         | 16   | 不为空 |        | 用户名   |
| 2    | user_gender   | ENUM('男','女','未知')                                       | 3    | 无     | 未知   | 性别     |
| 3    | user_birthday | DATE                                                         |      | 无     | NULL   | 生日     |
| 4    | user_phone    | CHAR                                                         | 16   | 无     | NULL   | 电话号码 |
| 5    | user_address  | VARCHAR                                                      | 100  | 无     | NULL   | 地址     |
| 6    | user_label    | SET('种植小白','种植老鸟','呆呆傻傻','略有所懂','高级花匠','访客','我真的不懂','我只是过来看看的') | 8    | 无     | NULL   | 标签     |
| 7    | open_id       | VARCHAR                                                      | 16   | 不为空 | 主键   | 用户id   |



## 用户植物数据表

**表名：user_plants**

**说明：用户植物**

**数据列：**

| 序号 | 字段名                                 | 类型     | 长度       | 约束      | 说明         |
| ---- | -------------------------------------- | -------- | ---------- | --------- | ------------ |
| 1    | <font color='red'>user_plant_id</font> | VARCHAR  | （待补充） | 主键      | 我的植物id   |
| 2    | plant_id                               | VARCHAR  | 16         | 外键/主键 | 植物百科id   |
| 3    | user_id                                | VARCHAR  | 16         | 主键      | 用户id       |
| 4    | plant_created                          | DATETIME |            | 不为空    | 植物添加时间 |
| 5    | plant_progress                         | CHAR     | 3          | 不为空    | 进度         |
| 8    | my_plant_image_url                     | VARCHAR  | 100        | 不为空    | 图片url      |

## 用户照料历史表

**表名：op_history**

**说明：用户照料历史**

**数据列：**

| 序号 | 字段名        | 类型                              | 长度       | 约束   | 说明         |
| ---- | ------------- | --------------------------------- | ---------- | ------ | ------------ |
| 1    | user_plant_id | VARCHAR                           | （待补充） | 不为空 | 用户植物id   |
| 2    | type          | ENUM('浇水','除虫','施肥','打药') | 4          | 不为空 | 照料类型     |
| 3    | next_time     | DATETIME                          |            | 无     | 下次照料时间 |

## login_session表

**表名：login_session**

**说明：登录信息**

**数据列：**

| 序号 | 字段名       | 类型     | 长度 | 约束   | 说明     |
| ---- | ------------ | -------- | ---- | ------ | -------- |
| 1    | session_key  | VARCHAR  | 128  | 不为空 | AES加密  |
| 2    | session_id   | VARCHAR  | 24   | 不为空 | token    |
| 3    | open_id      | VARCHAR  | 16   | 不为空 | 用户id   |
| 4    | created_time | DATETIME |      | 不为空 | 创建时间 |

## 用户百科收藏表

**表名：user_collection**

**说明：用户收藏列表**

**数据列：**

| 序号 | 字段名   | 类型    | 长度 | 约束      | 说明       |
| ---- | -------- | ------- | ---- | --------- | ---------- |
| 1    | user_id  | VARCHAR | 16   | 外键/主键 | 用户id     |
| 2    | plant_id | VARCHAR | 16   | 外键/主键 | 百科植物id |



# 视图

### 我的植物视图

**视图名：view_my_plants**

**说明：我的植物视图**

**数据列：**

| 序号 | 字段名                | 从属     | 说明         |
| ---- | --------------------- | -------- | ------------ |
| 1    | plant_name            | 植物百科 | 植物名       |
| 2    | plant_scientific_name | 植物百科 | 植物学名     |
| 3    | plant_alias_name      | 植物百科 | 植物别名     |
| 4    | temperature_demand    | 植物百科 | 温度需求     |
| 5    | water_demand          | 植物百科 | 水温需求     |
| 6    | plant_introduction    | 植物百科 | 植物简介     |
| 7    | plant_created         | 我的植物 | 植物创建时间 |
| 8    | user_id               | 我的植物 | 用户id       |

#### 代码：

```mysql
CREATE VIEW view_my_plants
AS
SELECT plants_encyclopedia.plant_name,plants_encyclopedia.plant_scientific_name,plants_encyclopedia.plant_alias_name,plants_encyclopedia.temperature_demand,plants_encyclopedia.water_demand,plants_encyclopedia.plant_introduction,user_plants.plant_created,user_plants.user_id
FROM plants_encyclopedia  JOIN user_plants
ON plants_encyclopedia.plant_id = user_plants.plant_id
```



#### 示例：

```mysql
SELECT * FROM view_my_plants 
WHERE user_id = 'abcd1';#abcd1为用户id
```

### 历史照料视图

**视图名：view_op_history**

**说明：历史照料视图**

**数据列：**

| 序号 | 字段名             | 从属                  | 说明            |
| ---- | ------------------ | --------------------- | --------------- |
| 1    | plant_id           | 用户植物(user_plants) | 植物id          |
| 2    | user_plant_id      | 用户植物              | 用户植物id      |
| 3    | plant_created      | 用户植物              | 植物创建时间    |
| 4    | my_plant_image_url | 用户植物              | 我的植物图片url |
| 5    | type               | 照料历史(op_history)  | 照料类型        |
| 6    | next_time          | 照料历史              | 下次照料时间    |
| 7    | user_id            | 用户植物              | 用户id          |

#### 代码：

```mysql
CREATE VIEW view_op_history
AS
SELECT u.plant_id,u.user_plant_id,u.plant_created,u.my_plant_image_url,o.type,o.next_time,u.user_id
FROM user_plants u JOIN op_history o JOIN user_information i
ON o.user_plant_id = u.user_plant_id AND u.user_id = i.open_id;
```

#### 示例：

```mysql
SELECT * FROM view_op_history
WHERE user_id = 'abcd1';#abcd1为用户id
```

### login_session视图

**视图名：login_session**

**说明：登录信息视图**

**数据列：**

| 序号 | 字段名      | 从属                       | 说明   |
| ---- | ----------- | -------------------------- | ------ |
| 1    | open_id     | 用户信息(user_information) | 用户id |
| 2    | user_name   |                            | 用户名 |
| 3    | session_key | login_session              |        |
| 4    | session_id  |                            |        |

#### 代码：

```mysql
CREATE VIEW view_login_session
AS
SELECT us_in.open_id,us_in.user_name, lo.session_key,lo.session_id
FROM user_information us_in JOIN login_session lo
ON us_in.open_id = lo.open_id;
```

#### 示例：

```mysql
SELECT * FROM view_login_session
WHERE open_id = 'abcd1';#abcd1为用户id
```

